<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–æ–º–ê—Ä–µ–Ω–¥–∞</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest/dist/lucide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">

<!-- –®–∞–ø–∫–∞ -->
<header class="bg-white shadow p-4 flex flex-col md:flex-row items-center justify-between">
  <div class="flex items-center space-x-3 mb-2 md:mb-0">
    <img src="–õ–æ–≥–æ—Ç–∏–ø.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-12 w-12 object-contain">
    <span class="text-2xl font-bold">–†–æ–º–ê—Ä–µ–Ω–¥–∞</span>
  </div>
  <div class="text-center mb-2 md:mb-0">
    <h1 class="text-xl font-semibold">–ê—Ä–µ–Ω–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</h1>
    <p class="text-sm text-gray-500">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–∏—Ö –∑–∞–¥–∞—á</p>
  </div>
  <div class="flex space-x-3">
    <button onclick="window.location.href='tel:+79152772441'" class="bg-green-500 text-white px-4 py-2 rounded flex items-center space-x-1">
      <i data-lucide="phone" class="w-5 h-5"></i><span>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</span>
    </button>
    <button onclick="toggleCart()" class="bg-blue-500 text-white px-4 py-2 rounded flex items-center space-x-1">
      <i data-lucide="shopping-cart" class="w-5 h-5"></i><span>–ö–æ—Ä–∑–∏–Ω–∞</span>
    </button>
  </div>
</header>

<!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
<section class="p-4">
  <input id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫..." class="border rounded w-full px-3 py-2 mb-2" oninput="filterItems()">
  <div id="tagsContainer" class="flex flex-wrap gap-2 mb-2"></div>
</section>

<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ -->
<section id="itemsContainer" class="p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
<div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
  <div class="bg-white w-full max-w-md p-6 rounded shadow-lg relative">
    <button onclick="toggleCart()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">
      <i data-lucide="x" class="w-6 h-6"></i>
    </button>
    <h2 class="text-xl font-bold mb-4">–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="cartItems" class="space-y-2 max-h-64 overflow-y-auto"></div>
    <div class="mt-4">
      <input id="clientName" type="text" placeholder="–ò–º—è" class="border rounded w-full px-3 py-2 mb-2">
      <input id="clientPhone" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" class="border rounded w-full px-3 py-2 mb-2" onfocus="maskPhone(this)">
      <div class="flex items-center mb-2">
        <label class="mr-2"><input type="radio" name="delivery" value="–°–∞–º–æ–≤—ã–≤–æ–∑" checked onchange="toggleAddress(this)"> –°–∞–º–æ–≤—ã–≤–æ–∑</label>
        <label><input type="radio" name="delivery" value="–î–æ—Å—Ç–∞–≤–∫–∞" onchange="toggleAddress(this)"> –î–æ—Å—Ç–∞–≤–∫–∞</label>
      </div>
      <input id="addressField" type="text" placeholder="–ê–¥—Ä–µ—Å" class="border rounded w-full px-3 py-2 mb-2 hidden">
      <button onclick="sendOrder()" class="bg-blue-500 text-white w-full py-2 rounded mt-2">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>
    </div>
  </div>
</div>

<script>
let items = [];
let cart = [];

// URL –≤–∞—à–µ–π –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π CSV —Ç–∞–±–ª–∏—Ü—ã
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQf1xA9dYH8nX9lFhH6D-J4zIVi1uZ0JekjgDQTx0b_aTOxA/pub?output=csv";

Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(results) {
    items = results.data.filter(i => i['–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ']);
    renderTags();
    renderItems();
  }
});

// –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
function renderItems(filterTag = "", search = "") {
  const container = document.getElementById('itemsContainer');
  container.innerHTML = '';
  let filtered = items.filter(item => 
    (!filterTag || item.–ö–∞—Ç–µ–≥–æ—Ä–∏—è === filterTag) &&
    (!search || item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.toLowerCase().includes(search.toLowerCase()))
  );

  filtered.forEach(item => {
    const card = document.createElement('div');
    card.className = "bg-white p-4 rounded shadow flex flex-col transition hover:shadow-lg";
    card.innerHTML = `
      <img src="${item.–§–æ—Ç–æ}" alt="${item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ}" class="h-32 object-contain mb-2">
      <h3 class="font-semibold">${item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ}</h3>
      <p class="text-sm text-gray-500">${item.–ö–∞—Ç–µ–≥–æ—Ä–∏—è}</p>
      <p class="text-green-600 font-bold">${item['–í –Ω–∞–ª–∏—á–∏–∏'] === "–î–∞" ? "–í –Ω–∞–ª–∏—á–∏–∏" : "–ù–µ—Ç"}</p>
      <p class="font-bold mt-1">–¶–µ–Ω—ã:</p>
      <ul>
        <li>1 –¥–µ–Ω—å - ${item['–¶–µ–Ω–∞/–°—É—Ç–∫–∏']}‚ÇΩ</li>
        <li>2 –¥–Ω—è - ${item['–¶–µ–Ω–∞/2—Å—É—Ç–æ–∫']}‚ÇΩ</li>
        <li>3 –¥–Ω—è - ${item['–¶–µ–Ω–∞/3—Å—É—Ç–æ–∫']}‚ÇΩ</li>
        <li>5 –¥–Ω–µ–π –∏ –±–æ–ª—å—à–µ - ${item['–û—Ç 5 —Å—É—Ç–æ–∫']}‚ÇΩ</li>
      </ul>
      <select id="daysSelect-${item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.replace(/\s+/g,'')}" class="border rounded p-1 mt-1">
        <option value="–¶–µ–Ω–∞/–°—É—Ç–∫–∏">1 –¥–µ–Ω—å</option>
        <option value="–¶–µ–Ω–∞/2—Å—É—Ç–æ–∫">2 –¥–Ω—è</option>
        <option value="–¶–µ–Ω–∞/3—Å—É—Ç–æ–∫">3 –¥–Ω—è</option>
        <option value="–û—Ç 5 —Å—É—Ç–æ–∫">5 –¥–Ω–µ–π –∏ –±–æ–ª—å—à–µ</option>
      </select>
      <button onclick="addToCart(${JSON.stringify(item).replace(/"/g,'&quot;')}, 'daysSelect-${item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ.replace(/\s+/g,'')}')" class="mt-2 bg-green-500 text-white py-1 px-2 rounded hover:bg-green-600 transition">–ó–∞–∫–∞–∑–∞—Ç—å</button>
    `;
    container.appendChild(card);
  });
  lucide.replace();
}

// –¢–µ–≥–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
function renderTags() {
  const container = document.getElementById('tagsContainer');
  const categories = [...new Set(items.map(i => i.–ö–∞—Ç–µ–≥–æ—Ä–∏—è))];
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = "bg-gray-200 px-3 py-1 rounded hover:bg-gray-300";
    btn.innerText = cat;
    btn.onclick = () => { renderItems(cat, document.getElementById('searchInput').value) };
    container.appendChild(btn);
  });
}

// –ü–æ–∏—Å–∫
function filterItems() {
  renderItems("", document.getElementById('searchInput').value);
}

// –ö–æ—Ä–∑–∏–Ω–∞
function addToCart(item, selectId) {
  const select = document.getElementById(selectId);
  const priceColumn = select.value;
  const price = parseFloat(item[priceColumn]);
  cart.push({ ...item, price, days: priceColumn });
  renderCart();
  toggleCart(true);
}

function renderCart() {
  const container = document.getElementById('cartItems');
  container.innerHTML = '';
  cart.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = "flex justify-between items-center bg-gray-100 p-2 rounded";
    div.innerHTML = `
      <span>${item.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ} (${item.days}) - ‚ÇΩ${item.price}</span>
      <button onclick="removeFromCart(${index})" class="text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
    `;
    container.appendChild(div);
  });
  lucide.replace();
}

function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
}

function toggleCart(forceOpen = false) {
  const modal = document.getElementById('cartModal');
  if(forceOpen) modal.classList.add('flex'); modal.classList.remove('hidden');
  else modal.classList.toggle('hidden'); modal.classList.toggle('flex');
}

// –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
function maskPhone(input) {
  if(!input.value) input.value = "+7 (";
  input.addEventListener('input', () => {
    let val = input.value.replace(/\D/g, '');
    if(val.startsWith('7')) val = val.slice(1);
    input.value = "+7 (" + (val.substring(0,3)) + (val.length>3?") "+val.substring(3,6):"") + (val.length>6?"-"+val.substring(6,8):"") + (val.length>8?"-"+val.substring(8,10):"");
  });
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
function toggleAddress(radio) {
  document.getElementById('addressField').classList.toggle('hidden', radio.value === "–°–∞–º–æ–≤—ã–≤–æ–∑");
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
function sendOrder() {
  if(!cart.length) { alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞"); return; }
  const name = document.getElementById('clientName').value.trim();
  const phone = document.getElementById('clientPhone').value.trim();
  if(!name || !phone) { alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è –∏ –¢–µ–ª–µ—Ñ–æ–Ω"); return; }

  const delivery = document.querySelector('input[name="delivery"]:checked').value;
  const address = delivery === "–î–æ—Å—Ç–∞–≤–∫–∞" ? document.getElementById('addressField').value.trim() : "–õ—é–±–ª–∏–Ω—Å–∫–∞—è 7/2 –∫1";
  const itemsText = cart.map(i => `${i.–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ} (${i.days})`).join(", ");
  const total = cart.reduce((sum, i) => sum + parseFloat(i.price), 0);

  let message = `üõ† –ó–ê–ö–ê–ó: ${itemsText}%0Aüí∞ –°–£–ú–ú–ê: ${total}‚ÇΩ%0Aüë§ –ö–õ–ò–ï–ù–¢: ${name}%0Aüìû –¢–ï–õ: ${phone}%0Aüìç –¢–ò–ü: ${delivery}`;
  if(delivery === "–î–æ—Å—Ç–∞–≤–∫–∞") message += `%0Aüè† –ê–î–†–ï–°: ${address}`;
  else message += `%0Aüìç –°–ö–õ–ê–î: ${address}`;

  const telegramLink = `https://www.google.com/search?q=https://t.me/RomArend?text=${message}`;
  window.open(telegramLink, '_blank');
}

</script>
</body>
</html>

