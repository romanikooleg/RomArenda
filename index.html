<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–æ–º–ê—Ä–µ–Ω–¥–∞ ‚Äî –∞—Ä–µ–Ω–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --main-yellow: #FFC107;
  --main-black: #1F1F1F;
  --light-gray: #F3F3F3;
  --white: #FFFFFF;
  --tg-blue: #0088cc; 
}

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
body { margin:0; font-family: 'Segoe UI', Arial, sans-serif; background: var(--light-gray); color: var(--main-black);}
a {text-decoration:none;}

header {background: var(--main-black); color: var(--white); padding:15px 20px; text-align:center;}
header .logo-container { display: flex; align-items: center; justify-content: space-between; flex-wrap: nowrap; }
header img { height: 100px; border-radius: 8px; object-fit: contain; }
header h1 { margin: 0; font-size: 1.8em; flex-grow: 1; text-align: left; margin-left: 12px; }
header p { margin: 0; font-size: 22px; text-align: right; font-weight: bold; color: var(--main-yellow); }

/* –§–∏–ª—å—Ç—Ä—ã */
.controls {display:flex; flex-wrap:wrap; gap:8px; justify-content:center; padding:12px; background: var(--white); box-shadow:0 2px 4px rgba(0,0,0,0.1); position:sticky; top:0; z-index:200;}
input, select {padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; outline: none;}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.container {display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:20px; padding:20px;}
.card {background: var(--white); border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.05); padding:15px; display:flex; flex-direction:column; transition: 0.3s; cursor:pointer; opacity:0; animation:fadeIn 0.5s forwards;}
.card:hover{transform:translateY(-5px); box-shadow:0 12px 20px rgba(0,0,0,0.1);}
.card img{width:100%; height:180px; object-fit:cover; border-radius:12px;}

.price {font-size: 1.2em; font-weight:bold; margin: 10px 0; color: var(--main-black);}

/* –ö–Ω–æ–ø–∫–∏ */
button {padding:12px; border:none; border-radius:10px; font-size:14px; cursor:pointer; font-weight:bold; transition: 0.2s;}
.cartBtn {background: var(--main-yellow); color: var(--main-black); margin-bottom: 8px;}
.oneClickBtn {background: var(--tg-blue); color: white;} 

/* –î–µ—Ç–∞–ª–∏ */
.card-details {max-height:0; overflow:hidden; transition: 0.4s; font-size: 0.9em; color: #666;}
.card.open .card-details{max-height:300px; padding-top:10px;}

/* –ö–æ—Ä–∑–∏–Ω–∞ */
#cartBox {position:fixed; inset:0; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:999;}
#cart {background:var(--white); padding:25px; border-radius:20px; width:90%; max-width:400px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);}
.cartItem {border-bottom:1px solid #eee; padding:10px 0; display: flex; justify-content: space-between; align-items: center;}

@keyframes fadeIn{from{opacity:0; transform:translateY(15px);} to{opacity:1; transform:translateY(0);}}

@media(max-width:600px){
  header .logo-container {flex-direction: column; align-items: flex-start;}
  header p {text-align:left; margin-top:6px; font-size: 20px;}
}
</style>
</head>
<body>

<header>
  <div class="logo-container">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src="logo.png" alt="–†–æ–º–ê—Ä–µ–Ω–¥–∞">
      <h1>–†–æ–º–ê—Ä–µ–Ω–¥–∞</h1>
    </div>
    <p>üìû +7 915 277 24 41</p>
  </div>
</header>

<div class="controls">
  <input id="search" placeholder="üîç –ü–æ–∏—Å–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞...">
  <select id="categoryFilter"><option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option></select>
  <button class="cartBtn" onclick="openCart()" style="margin:0; padding: 10px 20px;">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</button>
</div>

<div class="container" id="products"></div>

<div id="cartBox">
  <div id="cart">
    <h2 style="margin-top:0">üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
    <div id="cartItems"></div>
    <div id="totalPrice" style="margin: 15px 0; font-weight: bold; font-size: 1.2em; border-top: 2px solid #eee; padding-top: 10px;"></div>
    <input id="clientName" placeholder="–í–∞—à–µ –∏–º—è" style="width:100%; box-sizing:border-box; padding:12px; margin-bottom:10px; border: 1px solid #ddd; border-radius: 8px;">
    <input id="clientPhone" placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω" style="width:100%; box-sizing:border-box; padding:12px; margin-bottom:15px; border: 1px solid #ddd; border-radius: 8px;">
    <button onclick="sendOrder()" style="width:100%; background:var(--tg-blue); color:white; padding:15px; font-size: 16px;">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£</button>
    <button onclick="closeCart()" style="width:100%; background:none; color:#999; margin-top:10px;">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<script>
const TG_TOKEN = "8575516738:AAGomt_lCqq1Uzdqf7D4UrReolJF_NKhYoM"; 
const TG_CHAT_ID = "8359415363"; 

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOtUQAhnBMNrCPWFj0u6cjQeb0qWscrovHdCWvuBQMaCCirL4ds3i6NtjqwMpcReNsrhrY_X8ICXOL/pub?gid=2109115062&single=true&output=csv";

let products = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
document.getElementById("cartCount").textContent = cart.length;

fetch(sheetURL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1).map(r => r.trim()).filter(r => r !== "");
    products = rows.map(r => {
      const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if(!c[0] || !c[1]) return null;
      return {
        cat: c[0].trim(),
        name: c[1].trim(),
        desc: c[2] ? c[2].replace(/"/g, '').replace(/\n/g, ' ') : '–û–ø–∏—Å–∞–Ω–∏–µ —É—Ç–æ—á–Ω—è–π—Ç–µ',
        img: c[3] ? c[3].trim() : 'https://via.placeholder.com/300x180.png?text=–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç',
        p1: c[4] ? Number(c[4]) : 0
      };
    }).filter(p => p !== null);
    initFilters();
    render(products);
  });

function initFilters() {
  const f = document.getElementById("categoryFilter");
  [...new Set(products.map(p => p.cat))].forEach(cat => {
    const o = document.createElement("option"); o.value = cat; o.textContent = cat;
    f.appendChild(o);
  });
}

document.getElementById("search").addEventListener("input", () => {
    const val = document.getElementById("search").value.toLowerCase();
    render(products.filter(p => p.name.toLowerCase().includes(val)));
});

document.getElementById("categoryFilter").addEventListener("change", (e) => {
    const cat = e.target.value;
    render(cat === "all" ? products : products.filter(p => p.cat === cat));
});

function render(list) {
  const cont = document.getElementById("products");
  cont.innerHTML = "";
  list.forEach(i => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${i.img}">
      <h3>${i.name}</h3>
      <div class="price">${i.p1} ‚ÇΩ/—Å—É—Ç–∫–∏</div>
      <div class="card-details"><p>${i.desc}</p></div>
      <button class="cartBtn" onclick='addCart("${i.name}",${i.p1})'>–í –∫–æ—Ä–∑–∏–Ω—É</button>
      <button class="oneClickBtn" onclick='orderOneClick("${i.name}")'>–ó–∞–∫–∞–∑–∞—Ç—å –≤ 1 –∫–ª–∏–∫</button>
    `;
    card.onclick = (e) => { if(!e.target.closest("button")) card.classList.toggle("open"); };
    cont.appendChild(card);
  });
}

function addCart(name, price) {
  cart.push({name, price});
  localStorage.setItem('cart', JSON.stringify(cart));
  document.getElementById("cartCount").textContent = cart.length;
}

function openCart() { document.getElementById("cartBox").style.display="flex"; renderCart(); }
function closeCart() { document.getElementById("cartBox").style.display="none"; }

function renderCart() {
  const box = document.getElementById("cartItems");
  let total = 0;
  box.innerHTML = cart.length ? "" : "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞";
  cart.forEach((i, idx) => {
    total += i.price;
    box.innerHTML += `<div class="cartItem"><span>${i.name}</span> <b>${i.price}‚ÇΩ</b> <span onclick="removeFromCart(${idx})" style="color:red; cursor:pointer; font-weight:bold;">‚úï</span></div>`;
  });
  document.getElementById("totalPrice").textContent = cart.length ? `–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ/—Å—É—Ç.` : "";
}

function removeFromCart(idx) {
    cart.splice(idx, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById("cartCount").textContent = cart.length;
    renderCart();
}

async function sendToTelegram(text) {
    const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage`;
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ chat_id: TG_CHAT_ID, text: text, parse_mode: 'HTML' })
        });
        if(response.ok) {
            alert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –°–∫–æ—Ä–æ —Å–≤—è–∂–µ–º—Å—è.");
            return true;
        } else {
            alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º.");
        }
    } catch (e) {
        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.");
    }
}

function orderOneClick(itemName) {
    const phone = prompt("–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∑–∞–∫–∞–∑–∞ " + itemName + ":");
    if(phone && phone.length > 5) {
        const msg = `<b>‚ö°Ô∏è –ó–ê–ö–ê–ó –í 1 –ö–õ–ò–ö</b>\n\nüõ† –¢–æ–≤–∞—Ä: <code>${itemName}</code>\nüìû –¢–µ–ª: <code>${phone}</code>`;
        sendToTelegram(msg);
    }
}

function sendOrder() {
  const name = document.getElementById("clientName").value.trim();
  const phone = document.getElementById("clientPhone").value.trim();
  if(!name || !phone) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");

  let list = "<b>üõí –ù–û–í–´–ô –ó–ê–ö–ê–ó:</b>\n\n";
  let total = 0;
  cart.forEach((i, idx) => {
      list += `${idx+1}. ${i.name} (${i.price}‚ÇΩ)\n`;
      total += i.price;
  });
  list += `\nüí∞ <b>–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ/—Å—É—Ç.</b>\n\nüë§ –ò–º—è: ${name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}`;
  
  sendToTelegram(list).then(ok => {
      if(ok) {
          cart = [];
          localStorage.removeItem('cart');
          document.getElementById("cartCount").textContent = 0;
          closeCart();
      }
  });
}
</script>
</body>
</html>
