<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–æ–º–ê—Ä–µ–Ω–¥–∞ ‚Äî –∞—Ä–µ–Ω–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --main-yellow: #FFC107;
  --main-black: #1F1F1F;
  --light-gray: #F3F3F3;
  --white: #FFFFFF;
  --max-blue: #0078FF; /* –§–∏—Ä–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ MAX */
}

/* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
body { margin:0; font-family: Arial, sans-serif; background: var(--light-gray); color: var(--main-black);}
a{text-decoration:none;}

/* –•–µ–¥–µ—Ä */
header {background: var(--main-black); color: var(--white); padding:15px 20px; text-align:center;}
header .logo-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: nowrap;
}
header img {
  height: 120px;
  border-radius: 8px;
  object-fit: contain;
  transition: 0.3s;
}
header img:hover{transform:scale(1.1);}
header h1 {
  margin: 0;
  font-size: 2em;
  flex-grow: 1;
  text-align: left;
  margin-left: 12px;
}
header p {
  margin: 0;
  font-size: 28px;
  text-align: right;
}

/* –ö–æ–Ω—Ç—Ä–æ–ª—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
.controls {display:flex; flex-wrap:wrap; gap:8px; justify-content:center; padding:12px; background: var(--white); box-shadow:0 2px 4px rgba(0,0,0,0.1); position:sticky; top:0; z-index:200;}
input, select {padding:8px; border-radius:6px; border:1px solid #ccc; font-size:14px; transition:0.2s;}
input:focus, select:focus{border-color:var(--main-yellow); outline:none;}
label {font-size:14px; display:flex; align-items:center; gap:4px;}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
.container {display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:20px; padding:20px;}
.card {background: var(--white); border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.15); padding:10px; display:flex; flex-direction:column; transition:transform 0.3s, box-shadow 0.3s; cursor:pointer; overflow:hidden; opacity:0; animation:fadeIn 0.5s forwards;}
.card:hover{transform:translateY(-5px); box-shadow:0 8px 15px rgba(0,0,0,0.2);}
.card img{width:100%; height:180px; object-fit:cover; border-radius:10px; transition:0.3s;}
.card img:hover{transform:scale(1.05);}
.badge {padding:4px 8px; border-radius:6px; color:var(--main-black); font-size:12px; width:fit-content; margin-bottom:5px; font-weight:bold;}
.yes {background: var(--main-yellow);}
.no {background:#dc2626; color: white;}
.price {font-weight:bold; margin-top:5px;}

/* –ö–Ω–æ–ø–∫–∏ */
.card button {margin-top:6px; padding:10px; border:none; border-radius:8px; font-size:14px; cursor:pointer; transition:0.3s; font-weight:bold;}
.card button:hover{transform:scale(1.02); opacity: 0.9;}
.cartBtn {background: var(--main-yellow); color: var(--main-black);}
.maxBtn {background: var(--max-blue); color: white; display: block; width: 100%; text-align: center; margin-top: 5px;}

/* –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ */
.card-details {max-height:0; overflow:hidden; transition:max-height 0.5s ease, padding 0.5s ease;}
.card.open .card-details{max-height:200px; padding-top:10px;}

/* –ö–æ—Ä–∑–∏–Ω–∞ */
#cartBox {position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:999;}
#cart {background:var(--white); padding:20px; border-radius:12px; width:90%; max-width:400px; max-height:90%; overflow-y:auto; box-shadow:0 4px 15px rgba(0,0,0,0.25);}
#cart h3{margin-top:0;}
#cart input {width: 95%; margin-bottom: 10px;}
.cartItem{border-bottom:1px solid #ddd; padding:6px 0; font-size:14px;}
.sendOrderBtn {background: var(--max-blue); color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;}

/* Sticky –∫–Ω–æ–ø–∫–∞ */
.sticky-order-btn{position:fixed; bottom:15px; left:50%; transform:translateX(-50%); background:var(--main-yellow); padding:12px 20px; border-radius:8px; font-weight:bold; z-index:300; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.25); transition:0.3s;}

@keyframes fadeIn{from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);}}

@media(max-width:600px){
  header .logo-container {flex-direction: column; align-items: flex-start;}
  header p {text-align:left; margin-top:6px; font-size: 22px;}
}
</style>
</head>
<body>

<header>
  <div class="logo-container">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src="logo.png" alt="–†–æ–º–ê—Ä–µ–Ω–¥–∞">
      <h1>–†–æ–º–ê—Ä–µ–Ω–¥–∞</h1>
    </div>
    <p>üìû +7 915 277 24 41</p>
  </div>
</header>

<div class="controls">
  <input id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">
  <select id="categoryFilter"><option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option></select>
  <label><input type="checkbox" id="availableOnly"> –í –Ω–∞–ª–∏—á–∏–∏</label>
  <select id="sortPrice">
    <option value="none">–ë–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</option>
    <option value="asc">–¶–µ–Ω–∞ ‚Üë</option>
    <option value="desc">–¶–µ–Ω–∞ ‚Üì</option>
  </select>
  <button class="cartBtn" onclick="openCart()">–ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</button>
</div>

<div class="container" id="products"></div>

<div id="cartBox">
  <div id="cart">
    <h3>üõí –í–∞—à –∑–∞–∫–∞–∑</h3>
    <div id="cartItems"></div>
    <hr>
    <input id="clientName" placeholder="–í–∞—à–µ –∏–º—è">
    <input id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏">
    <button class="sendOrderBtn" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –≤ MAX</button>
    <button style="width:100%; background:none; border:none; margin-top:10px; cursor:pointer; color:gray;" onclick="closeCart()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∫—É–ø–∫–∞–º</button>
  </div>
</div>

<button class="sticky-order-btn" onclick="openCart()">–û—Ñ–æ—Ä–º–∏—Ç—å –∞—Ä–µ–Ω–¥—É</button>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOtUQAhnBMNrCPWFj0u6cjQeb0qWscrovHdCWvuBQMaCCirL4ds3i6NtjqwMpcReNsrhrY_X8ICXOL/pub?gid=2109115062&single=true&output=csv";
const myMaxPhone = "79152772441"; // –¢–≤–æ–π –Ω–æ–º–µ—Ä –¥–ª—è MAX

let products = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
document.getElementById("cartCount").textContent = cart.length;

fetch(sheetURL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1).map(r => r.trim()).filter(r => r !== "");
    products = rows.map(r => {
      const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if(!c[0] || !c[1]) return null;
      return {
        cat: c[0].trim(),
        name: c[1].trim(),
        desc: c[2] ? c[2].replace(/"/g, '').replace(/\n/g, ' ') : '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
        img: c[3] ? c[3].trim() : 'https://via.placeholder.com/300x180.png?text=–ù–µ—Ç+—Ñ–æ—Ç–æ',
        p1: c[4] ? Number(c[4]) : 0,
        avail: c[8] ? c[8].trim().replace(/"/g,'').toLowerCase() === "–¥–∞" : false
      };
    }).filter(p => p !== null);

    initFilters();
    applyFilters();
  });

function initFilters() {
  const f = document.getElementById("categoryFilter");
  [...new Set(products.map(p => p.cat))].forEach(cat => {
    const o = document.createElement("option"); o.value = cat; o.textContent = cat;
    f.appendChild(o);
  });
}

document.getElementById("search").addEventListener("input", applyFilters);
document.getElementById("categoryFilter").addEventListener("change", applyFilters);
document.getElementById("sortPrice").addEventListener("change", applyFilters);
document.getElementById("availableOnly").addEventListener("change", applyFilters);

function applyFilters() {
  let filtered = [...products];
  const search = document.getElementById("search").value.toLowerCase();
  const cat = document.getElementById("categoryFilter").value;
  const sort = document.getElementById("sortPrice").value;
  const available = document.getElementById("availableOnly").checked;

  if(cat !== "all") filtered = filtered.filter(p => p.cat === cat);
  if(search) filtered = filtered.filter(p => p.name.toLowerCase().includes(search));
  if(available) filtered = filtered.filter(p => p.avail);
  if(sort === "asc") filtered.sort((a,b) => a.p1 - b.p1);
  if(sort === "desc") filtered.sort((a,b) => b.p1 - a.p1);

  render(filtered);
}

function render(list) {
  const cont = document.getElementById("products");
  cont.innerHTML = "";
  list.forEach(i => {
    const badgeClass = i.avail ? "yes" : "no";
    const badgeText = i.avail ? "–í –Ω–∞–ª–∏—á–∏–∏" : "–ó–∞–Ω—è—Ç";
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <span class="badge ${badgeClass}">${badgeText}</span>
      <img src="${i.img}" alt="${i.name}">
      <h3>${i.name}</h3>
      <div class="price">–û—Ç ${i.p1} ‚ÇΩ/—Å—É—Ç–∫–∏</div>
      <div class="card-details"><p>${i.desc}</p></div>
      <button class="cartBtn" onclick='addCart("${i.name}",${i.p1})'>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      <button class="maxBtn" onclick="directMax('${i.name}')">–°–ø—Ä–æ—Å–∏—Ç—å –≤ MAX</button>
    `;
    card.addEventListener("click", (e) => {
      if(!e.target.closest("button")) card.classList.toggle("open");
    });
    cont.appendChild(card);
  });
}

function addCart(name, price) {
  cart.push({name, price});
  localStorage.setItem('cart', JSON.stringify(cart));
  document.getElementById("cartCount").textContent = cart.length;
}

function openCart() { document.getElementById("cartBox").style.display="flex"; renderCart(); }
function closeCart() { document.getElementById("cartBox").style.display="none"; }

function renderCart() {
  const box = document.getElementById("cartItems");
  box.innerHTML = cart.length ? "" : "<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p>";
  cart.forEach((i, index) => {
    const d = document.createElement("div");
    d.className = "cartItem";
    d.innerHTML = `<span>${i.name}</span> <b>${i.price}‚ÇΩ</b> <span style="color:red; cursor:pointer; float:right;" onclick="removeItem(${index})">‚úï</span>`;
    box.appendChild(d);
  });
}

function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem('cart', JSON.stringify(cart));
  document.getElementById("cartCount").textContent = cart.length;
  renderCart();
}

// –ü—Ä—è–º–∞—è —Å–≤—è–∑—å –ø–æ —Ç–æ–≤–∞—Ä—É
function directMax(itemName) {
  const text = encodeURIComponent(`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∞—Ä–µ–Ω–¥–∞: ${itemName}. –ï—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏?`);
  window.open(`https://max.ru/chat/${myMaxPhone}?text=${text}`, "_blank");
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–π –∫–æ—Ä–∑–∏–Ω—ã
function sendOrder() {
  if(!cart.length) return alert("–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É");
  const name = document.getElementById("clientName").value.trim();
  const phone = document.getElementById("clientPhone").value.trim();
  
  if(!name || !phone) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");

  let orderList = "";
  cart.forEach((i, idx) => orderList += `${idx+1}. ${i.name} (${i.price}‚ÇΩ)\n`);
  
  const fullText = `üöÄ –ù–û–í–´–ô –ó–ê–ö–ê–ó –° –°–ê–ô–¢–ê:\n\n${orderList}\nüë§ –ö–ª–∏–µ–Ω—Ç: ${name}\nüìû –¢–µ–ª: ${phone}`;
  const maxUrl = `https://max.ru/chat/${myMaxPhone}?text=${encodeURIComponent(fullText)}`;
  
  window.open(maxUrl, "_blank");
}
</script>

</body>
</html>



